<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.AlarmRecordMapper">

    <!-- 查询告警记录 -->
    <select id="selectAlarmRecord" resultType = "com.ruoyi.system.domain.dto.largeScreen.AlarmRecordDTO">
        select ar.alarm_id as alarmId,
        ar.alarm_type as alarmType,
        ar.alarm_content as alarmContent,
        ar.start_time as startTime,
        ar.end_time as endTime,
        ar.alarm_status as alarmStatus,
        ar.handle_status as handleStatus
        from alarm_record as ar
        <where>
            <if test="alarmType != null">
                and ar.alarm_type = #{alarmType}
            </if>
            <if test="startTime != null">
                and ar.start_time &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                and ar.end_time &lt;= #{endTime}
            </if>
        </where>
        order by ar.start_time desc
    </select>

    <!--获取同一计划，最大的报警次数-->
    <select id="selectMaxNumber" resultType="java.lang.Integer">
        select ifnull(max(number), 0)
        from alarm_record as ar
        where ar.plan_id = #{planId} and ar.alarm_threshold = #{alarmThreshold}
    </select>

    <!--获取同一工程，最大的报警次数-->
    <select id="selectMaxNumberT" resultType="java.lang.Integer">
        select ifnull(max(number), 0)
        from alarm_record as ar
        where ar.project_id = #{projectId}
    </select>
</mapper>