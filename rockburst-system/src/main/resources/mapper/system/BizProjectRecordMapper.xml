<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.BizProjectRecordMapper">


    <select id="queryDateByPage" resultType="com.ruoyi.system.domain.dto.ReportFormsDTO">
        select
            bpr.project_id as projectId,
            bpr.construct_time as constructTime,
            bpr.drill_type as drillType,
            bpr.construct_unit_id as constructUnitId,
            bpr.construct_shift_id as constructShiftId,
            bpr.construct_type as constructType,
            bpr.location_id as locationId,
            bpr.drill_num as drillNum,
            bpr.worker as worker,
            bpr.accepter as accepter,
            bpr.create_time as createTime
        from biz_project_record as bpr
        where bpr.drill_type in
        <foreach collection="drillTypes" item="drillType" index="index" open="(" close=")" separator=",">
            #{drillType}
        </foreach>
        <if test="startTime != null and endTime != null">
            and bpr.construct_time between #{startTime} and #{endTime}
        </if>
        and bpr.del_flag = '0'
        order by bpr.construct_time desc
    </select>

    <select id="queryProjectOfAudit" resultType="com.ruoyi.system.domain.dto.largeScreen.ProjectDTO">
        select
            bpr.project_id as projectId,
            bpr.construct_type as constructType,
            bpr.drill_type as drillType,
            bpr.construct_unit_id as constructUnitId,
            bpr.construct_time as constructTime,
            bpr.tunnel_id as tunnelId,
            bpr.workface_id as workFaceId,
           bpr.status as status
        from biz_project_record as bpr
        <where>
            <if test="constructionUnitId != null and constructionUnitId != ''">
                and bpr.construct_unit_id = #{constructionUnitId}
            </if>
            <if test="fillingType != null and fillingType != ''">
                and bpr.drill_type = #{fillingType}
            </if>
            <if test="startTime != null and endTime != null">
                and bpr.construct_time between #{startTime} and #{endTime}
            </if>
            and bpr.status = 3
        </where>
        order by bpr.construct_time desc
    </select>

    <select id="queryProjectOfUnaudited" resultType="com.ruoyi.system.domain.dto.largeScreen.ProjectDTO">
        select
        bpr.project_id as projectId,
        bpr.construct_type as constructType,
        bpr.drill_type as drillType,
        bpr.construct_unit_id as constructUnitId,
        bpr.construct_time as constructTime,
        bpr.tunnel_id as tunnelId,
        bpr.workface_id as workFaceId,
        bpr.status as status
        from biz_project_record as bpr
        <where>
            <if test="constructionUnitId != null and constructionUnitId != ''">
                and bpr.construct_unit_id = #{constructionUnitId}
            </if>
            <if test="fillingType != null and fillingType != ''">
                and bpr.drill_type = #{fillingType}
            </if>
            <if test="startTime != null and endTime != null">
                and bpr.construct_time between #{startTime} and #{endTime}
            </if>
            and bpr.status in (1,2)
        </where>
        order by bpr.construct_time desc
    </select>

    <select id="queryProjectType" resultType="com.ruoyi.system.domain.dto.largeScreen.ProjectTypeDTO">
        select drill_type as drillType,
               count(*) as count
        from biz_project_record
        where del_flag = '0',
            <if test="startTime != null and endTime != null">
                and construct_time between #{startTime} and #{endTime}
            </if>
        group by
            drill_type
    </select>

</mapper>