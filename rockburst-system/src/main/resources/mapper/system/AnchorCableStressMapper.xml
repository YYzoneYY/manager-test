<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.AnchorCableStressMapper">

    <!--获取最大测点编码，tag = '1'-->
    <select id="selectMaxMeasureNum" resultType="java.lang.String">
        SELECT ifnull(max(measure_num), 0)
        FROM drilling_stress
        WHERE sensor_type = #{sensorType} AND tag = '1'
          AND del_flag = '0'
        ORDER BY SUBSTRING(measure_num, -4) DESC LIMIT 1;
    </select>

    <select id="selectQueryPage" parameterType="com.ruoyi.system.domain.dto.MeasureSelectDTO" resultType="com.ruoyi.system.domain.vo.AnchorCableStressVO">
        SELECT
            acs.anchor_cable_stress_id AS anchorCableStressId,
            acs.measure_num AS measureNum,
            acs.survey_area_name AS surveyAreaName,
            acs.workface_id AS workFaceId,
            acs.sensor_type AS sensorType,
            acs.sensor_location AS sensorLocation,
            acs.install_time AS installTime,
            acs.breaking_value AS breakingValue,
            acs.status AS status
        FROM anchor_cable_stress acs
        <where>
            <if test="surveyAreaName != null and surveyAreaName != ''">
                AND acs.survey_area_name like concat('%',#{surveyAreaName},'%')
            </if>
            <if test="workFaceId != null and workFaceId != ''">
                AND acs.workface_id = #{workFaceId}
            </if>
            <if test="status != null and status != ''">
                AND acs.status = #{status}
            </if>
            <if test="startTime != null">
                AND acs.install_time &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND acs.install_time &lt;= #{endTime}
            </if>
            AND acs.del_flag = '0'
        </where>
        ORDER BY acs.install_time DESC
    </select>

</mapper>