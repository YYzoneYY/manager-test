<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.DepartmentAuditMapper">

    <!--获取同一工程填报，最大的审核次数-->
    <select id="selectMaxNumber" resultType="java.lang.Integer">
        select ifnull(max(number), 0)
        from department_audit as da
        where da.project_id = #{projectId} and da.del_flag = '0'
    </select>

    <select id="queryByPage" resultType="com.ruoyi.system.domain.vo.ProjectVO">
        select
        bpr.project_id as projectId,
        bpr.construct_type as constructType,
        bpr.drill_type as drillType,
        bpr.construct_unit_id as constructUnitId,
        bpr.construct_time as constructTime,
        bpr.Tunnel_id as constructSiteId,
        bpr.drill_num as drillNum,
        bpr.location as location,
        bpr.create_time as createTime,
        bpr.del_flag as delFlag
        from biz_project_record as bpr
        <where>
            <if test="selectDeptAuditDTO.type != null and selectDeptAuditDTO.type != ''">
                and bpr.construct_type = #{constructType}
            </if>
            <if test="selectDeptAuditDTO.constructSite != null and selectDeptAuditDTO.constructSite != ''">
                and bpr.Tunnel_id = #{constructSite}
            </if>
            <if test="selectDeptAuditDTO.constructionUnitId != null and selectDeptAuditDTO.constructionUnitId != ''">
                and bpr.construct_unit_id = #{constructUnitId}
            </if>
            <if test="selectDeptAuditDTO.fillingType != null and selectDeptAuditDTO.fillingType != ''">
                and bpr.drill_type = #{fillingType}
            </if>
            <if test="selectDeptAuditDTO.startTime != null and selectDeptAuditDTO.endTime != null">
                and bpr.construct_time between #{startTime} and #{endTime}
            </if>
            <if test="projectIds != null and projectIds.size() > 0 ''">
                and bpr.project_id in (${projectIds})
            </if>
            and p.del_flag = '0'
        </where>
        order by c.construct_time desc
    </select>
</mapper>