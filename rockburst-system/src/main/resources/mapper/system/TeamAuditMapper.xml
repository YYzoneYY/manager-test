<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.TeamAuditMapper">
    <!--获取同一工程填报，最大的审核次数-->
    <select id="selectMaxNumber" resultType="java.lang.Integer">
        select ifnull(max(number), 0)
        from team_audit as ta
        where ta.project_id = #{projectId} and ta.del_flag = '0'
    </select>

    <select id="queryByPage" parameterType="com.ruoyi.system.domain.dto.SelectProjectDTO"
            resultType="com.ruoyi.system.domain.vo.ProjectVO">
        select
            bpr.project_id as projectId,
            bpr.construct_type as constructType,
            bpr.drill_type as drillType,
            bpr.construct_unit_id as constructUnitId,
            bpr.construct_time as constructTime,
            bpr.Tunnel_id as constructSiteId,
            bpr.drill_num as drillNum,
            bpr.location as location,
            bpr.status as status,
            bpr.create_time as createTime,
            bpr.del_flag as delFlag
        from biz_project_record as bpr
        <where>
            <if test="type != null and type != ''">
                and bpr.construct_type = #{constructType}
            </if>
            <if test="constructSite != null and constructSite != ''">
                and bpr.Tunnel_id = #{constructSite}
            </if>
            <if test="constructionUnitId != null and constructionUnitId != ''">
                and bpr.construct_unit_id = #{constructUnitId}
            </if>
            <if test="fillingType != null and fillingType != ''">
                and bpr.drill_type = #{fillingType}
            </if>
            <if test="state != null and state != ''">
                and bpr.status = #{state}
            </if>
            <if test="startTime != null and endTime != null">
                and bpr.construct_time between #{startTime} and #{endTime}
            </if>
            and bpr.status in (1,2) and p.del_flag = '0'
        </where>
        order by c.construct_time desc
    </select>
</mapper>